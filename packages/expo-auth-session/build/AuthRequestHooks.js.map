{"version":3,"file":"AuthRequestHooks.js","sourceRoot":"","sources":["../src/AuthRequestHooks.ts"],"names":[],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport { Linking, Platform } from 'react-native';\n\nimport {\n  maybeCompleteAuthRequestAfterRedirectAsync,\n  AuthRequest,\n  AuthRequestConfig,\n} from './AuthRequest';\nimport { AuthSessionResult } from './AuthSession.types';\nimport { Discovery, IssuerOrDiscovery, resolveDiscoveryAsync } from './Discovery';\nimport * as QueryParams from './QueryParams';\n\nexport function useLinking(): string | null {\n  const [link, setLink] = useState<string | null>(null);\n\n  function onChange({ url }: { url: string | null }) {\n    setLink(url);\n  }\n\n  useEffect(() => {\n    Linking.getInitialURL().then(url => setLink(url));\n    Linking.addEventListener('url', onChange);\n    return () => {\n      Linking.removeEventListener('url', onChange);\n    };\n  }, []);\n\n  return link;\n}\n\nexport function useQueryParams(): Record<string, string> | null {\n  const [queryParams, setQueryParams] = useState<Record<string, string> | null>(null);\n  const link = useLinking();\n  useEffect(() => {\n    if (link) {\n      const { params } = QueryParams.getQueryParams(link);\n      setQueryParams(params);\n    } else {\n      setQueryParams(null);\n    }\n  }, [link]);\n\n  return queryParams;\n}\n\nexport function clearQueryParams() {\n  if (Platform.OS !== 'web') return;\n  // Get the full URL.\n  const currURL = window.location.href;\n\n  const url = new window.URL(currURL);\n  // Append the pathname to the origin (i.e. without the search).\n  const nextUrl = url.origin + url.pathname;\n\n  // Here you pass the new URL extension you want to appear after the domains '/'. Note that the previous identifiers or \"query string\" will be replaced.\n  window.history.pushState({}, window.document.title, nextUrl);\n}\n\nexport function useDiscovery(issuerOrDiscovery: IssuerOrDiscovery): Discovery | null {\n  const [discovery, setDiscovery] = useState<Discovery | null>(null);\n\n  useEffect(() => {\n    resolveDiscoveryAsync(issuerOrDiscovery).then(discovery => {\n      setDiscovery(discovery);\n    });\n  }, [issuerOrDiscovery]);\n\n  return discovery;\n}\n\nexport function useCompleteRedirect(): AuthSessionResult | null {\n  if (Platform.OS !== 'web') return null;\n\n  const [authState, setAuthState] = useState<AuthSessionResult | null>(null);\n  const link = useLinking();\n\n  useEffect(() => {\n    if (link)\n      maybeCompleteAuthRequestAfterRedirectAsync(link).then(result => {\n        if (result) {\n          clearQueryParams();\n          setAuthState(result);\n        }\n      });\n  }, [link]);\n\n  return authState;\n}\n\nexport function useAuthRequest(config: AuthRequestConfig): AuthRequest | null {\n  const [request, setRequest] = useState<AuthRequest | null>(null);\n\n  useEffect(() => {\n    if (config) {\n      const authRequest = new AuthRequest({\n        ...config,\n      });\n      authRequest.buildUrlAsync().then(() => setRequest(authRequest));\n    }\n  }, [\n    config.clientId,\n    config.redirectUri,\n    config.scopes.join(','),\n    config.clientSecret,\n    config.codeChallenge,\n    config.state,\n    JSON.stringify(config.extraParams || {}),\n    config.usePKCE,\n    JSON.stringify(config.discovery || {}),\n    config.issuer,\n  ]);\n\n  return request;\n}\n"]}